<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>将棋の殿堂</title>
    <link rel="stylesheet" href="style.css?v=20251101-a">
</head>
<body>
<header>
<p><a href="https://ulti-shogi.github.io/beta-open/index.html">TOPページに戻る</a></>
</header>
  <main>
<!-- ✅ 検索UIは後回しなので最小だけ -->
<section>
  <p>棋士プロフィール一覧（初期表示）</p>
</section>

<!-- ✅ 初期表示テーブル（thead/tbodyだけ用意しておく） -->
<table>
  <thead></thead>
  <tbody></tbody>
</table>

<div class="free">
  <h3>自由欄</h3>
  <p>補足情報など自由に書き込む。</p>
      </div>

  </main>
  <footer>フッター</footer>

<script>
// =======================================
// profile.html 初期表示用
// 原則10か条対応版
// 1) sectionにUI（今回は最小）
// 2) tableに結果
// 3) CSVは列名で参照
// 4) スマホ前提なので最初は5列だけ表示
// 5) 後で列を増やせるようにtdはループで生成
// =======================================

const CSV_URL = 'profile.csv';

// 初期表示で出す列（表示ラベルとキーを分けておく）
const INITIAL_COLUMNS = [
  { key: '区分', label: '区分' },
  { key: '席次', label: '席次' },
  { key: '棋士番号', label: '棋士番号' },
  { key: '棋士名', label: '棋士名' },
  // 段位または称号はCSVの列には無いので、後で作る
  { key: '__dan_or_title__', label: '段位/称号' }
];

fetch(CSV_URL)
  .then(res => res.text())
  .then(text => {
    const rows = parseCSV(text);
    const enriched = rows.map(r => makeDanOrTitle(r));
    renderInitialTable(enriched);
  })
  .catch(err => {
    console.error('CSVの読み込みに失敗しました', err);
  });

// -------------------------------
// CSVを配列にする（列名で参照）
// ※ ダブルクォートなど複雑なCSVは想定しない
// -------------------------------
function parseCSV(csvText) {
  const lines = csvText.trim().split(/\r?\n/);
  if (!lines.length) return [];
  const header = lines[0].split(',').map(h => h.trim());
  const data = [];

  for (let i = 1; i < lines.length; i++) {
    if (!lines[i].trim()) continue;
    const cols = lines[i].split(',');
    const row = {};
    header.forEach((h, idx) => {
      row[h] = (cols[idx] || '').trim();
    });
    data.push(row);
  }
  return data;
}

// -------------------------------
// 段位/称号を生成する
// 称号があればそれを、なければ段位を、どちらも無ければ空欄
// -------------------------------
function makeDanOrTitle(row) {
  const title = (row['称号'] || '').trim();
  const dan = (row['段位'] || '').trim();
  const danOrTitle = title ? title : dan ? dan : '';
  // 新しいキーを追加して返す
  return Object.assign({}, row, { '__dan_or_title__': danOrTitle });
}

// -------------------------------
// 初期表示テーブルを描画する
// -------------------------------
function renderInitialTable(rows) {
  const table = document.querySelector('table');
  const thead = table.querySelector('thead');
  const tbody = table.querySelector('tbody');

  // theadを作成
  thead.innerHTML = '';
  const trHead = document.createElement('tr');
  INITIAL_COLUMNS.forEach(col => {
    const th = document.createElement('th');
    th.textContent = col.label;
    trHead.appendChild(th);
  });
  thead.appendChild(trHead);

  // tbodyを作成
  tbody.innerHTML = '';
  rows.forEach(row => {
    const tr = document.createElement('tr');
    INITIAL_COLUMNS.forEach(col => {
      const td = document.createElement('td');
      td.textContent = row[col.key] || '';
      tr.appendChild(td);
    });
    tbody.appendChild(tr);
  });
}
</script>
</body>
</html>

