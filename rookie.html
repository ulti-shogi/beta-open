<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>将棋の殿堂</title>
    <link rel="stylesheet" href="style.css?v=20251016-a">
</head>
<body>
<header>
<p><a href="https://ulti-shogi.github.io/beta-open/index.html">TOPページに戻る</a></>
</header>
  <main>
<section>
<h2>歴代将棋新人王戦</h2>
  <!-- 表示モード（セレクト） -->
  <div>
    <label>表示：
      <select id="viewMode">
        <option value="">表示するものを選んでください</option>
        <option value="final">決勝三番勝負の結果一覧</option>
        <option value="memorial">新人王記念対局一覧</option>
        <option value="age">年齢順一覧</option>
      </select>
    </label>
  </div>

  <!-- 件数フィルタ（上位◯件） -->
  <div>
    <label>上位
      <input type="number" id="yearRange" min="1" placeholder="10">
      件
    </label>
    <button id="applyRange">表示</button>
  </div>

  <!-- 並び替え -->
  <div>
    <span>並び替え：</span>
    <label><input type="radio" name="sortKey" value="nendo" checked> 年度順</label>
    <label><input type="radio" name="sortKey" value="age"> 年齢順</label>

    <label><input type="radio" name="sortOrder" value="asc"> 昇順</label>
    <label><input type="radio" name="sortOrder" value="desc" checked> 降順</label>
  </div>

</section>
      
<table>
  <thead></thead>
    <tbody></tbody>
</table>

<div class="free">
  <h3>出典</h3>
  <p>補足情報など自由に書き込む。</p>
      </div>

  </main>
  <footer>フッター</footer>

<script>
document.addEventListener("DOMContentLoaded", () => {
  let data = [];
  let initialRendered = false;

  fetch("rookie.csv")
    .then(res => res.text())
    .then(csvText => {
      const rows = csvText.trim().split("\n").map(r => r.split(","));
      rows.shift();

      data = rows.map(row => ({
        period: row[0],
        years: Number(row[1]),
        winner: row[2],
        score: row[3],
        "runner-up": row[4],
        result: row[5],
        champion: row[6],
        birth: row[7],
        victory: row[8],
        age: row[9],
        days: Number(row[10]),
        ranking: row[11]
      }));

      renderTable();
    });

  const viewModeSelect = document.querySelector("select[name='viewMode']");
  const sortFieldRadios = document.querySelectorAll("input[name='sortField']");
  const sortDirRadios = document.querySelectorAll("input[name='sortDir']");
  const countInput = document.querySelector("input[name='count']");
  const tableBody = document.querySelector("#result tbody");
  const tableHead = document.querySelector("#result thead");

  function renderTable() {
    let filtered = [...data];
    let viewMode = viewModeSelect.value;
    let sortField = document.querySelector("input[name='sortField']:checked").value;
    let sortDir = document.querySelector("input[name='sortDir']:checked").value;
    let count = Number(countInput.value);

    // ✅ 初期表示は強制的に「決勝モード + 直近10年 + 5列表示」
    if (!initialRendered) {
      const latest = Math.max(...data.map(d => d.years));
      filtered = filtered.filter(row => row["years"] >= latest - 9);
      viewMode = "final";  // ← 強制決勝モード
      viewModeSelect.value = ""; // 視覚上は未選択のまま
      sortField = "nendo";
      sortDir = "desc";
      initialRendered = true;
    }

    // ✅ 並び替え
    filtered.sort((a, b) => {
      let vA, vB;
      if (sortField === "nendo") { vA = a.years; vB = b.years; }
      else if (sortField === "age") { vA = a.days; vB = b.days; }
      if (vA < vB) return sortDir === "asc" ? -1 : 1;
      if (vA > vB) return sortDir === "asc" ? 1 : -1;
      return 0;
    });

    if (count > 0) {
      filtered = filtered.slice(0, count);
    }

    // ✅ 列構成（初期表示中は無条件で5列固定）
    let headers = ["period", "years", "winner", "score", "runner-up"];

    // ✅ セレクトで解放された後のみ通常判定に戻す
    if (initialRendered && viewMode !== "" && viewMode !== "final") {
      headers = ["period", "years", "winner"];
      if (viewMode === "memorial") {
        headers.push("result", "champion");
      } else if (viewMode === "age") {
        headers.push("age", "ranking");
      }
    }

    const LABELS = {
      period: "期", years: "年度", winner: "優勝者", score: "勝敗",
      "runner-up": "準優勝", result: "結果", champion: "保持者",
      birth: "生年月日", victory: "優勝日", age: "年齢", days: "日数換算",
      ranking: "順位"
    };

    tableHead.innerHTML = `<tr>${headers.map(k => `<th>${LABELS[k]}</th>`).join("")}</tr>`;
    tableBody.innerHTML = filtered.map(row => `
      <tr>${headers.map(k => `<td>${row[k] || ""}</td>`).join("")}</tr>
    `).join("");
  }

  viewModeSelect.addEventListener("change", renderTable);
  sortFieldRadios.forEach(r => r.addEventListener("change", renderTable));
  sortDirRadios.forEach(r => r.addEventListener("change", renderTable));
  countInput.addEventListener("input", renderTable);
});
</script>

</body>
</html>

